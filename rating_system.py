"""
–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ - —Ä—É—á–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
–†–∞–±–æ—Ç–∞–µ—Ç —Å MongoDB
"""

from datetime import datetime
from database import get_db_manager


def calculate_user_rating_manual(user_id):
    """
    –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    
    Args:
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    Returns:
        float: –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—Ç 1.0 –¥–æ 5.0)
    """
    db = get_db_manager()
    rating_data = db.get_user_rating(user_id)
    
    if rating_data:
        return rating_data.get('rating', 5.0)
    else:
        return 5.0  # –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π


def get_rating_description(user_rating):
    """
    –ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
    
    Args:
        user_rating: –ß–∏—Å–ª–æ–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥ (–æ—Ç 1.0 –¥–æ 5.0)
    
    Returns:
        str: –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
    """
    if user_rating >= 4.5:
        return '‚≠ê –û—Ç–ª–∏—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    elif user_rating >= 4.0:
        return 'üëç –•–æ—Ä–æ—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    elif user_rating >= 3.0:
        return '‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ'
    elif user_rating >= 2.0:
        return '‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    else:
        return 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'


def get_condition_description(condition):
    """–ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Å–æ–ª–∏"""
    descriptions = {
        'perfect': '‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ',
        'minor_damage': '‚ö†Ô∏è –ù–µ–±–æ–ª—å—à–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è',
        'major_damage': '‚ùå –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è',
        'lost': 'ÔøΩ –ö–æ–Ω—Å–æ–ª—å –ø–æ—Ç–µ—Ä—è–Ω–∞/—É–∫—Ä–∞–¥–µ–Ω–∞'
    }
    return descriptions.get(condition, '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')


def get_compliance_description(compliance):
    """–ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–∞–≤–∏–ª–∞–º"""
    descriptions = {
        'no_violations': '‚úÖ –ë–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏–π',
        'minor_violations': '‚ö†Ô∏è –ù–µ–±–æ–ª—å—à–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è',
        'major_violations': '‚ùå –°–µ—Ä—å–µ–∑–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è'
    }
    return descriptions.get(compliance, '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')


def get_timing_description(timing):
    """–ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞"""
    descriptions = {
        'on_time': '‚úÖ –í–æ–≤—Ä–µ–º—è',
        'late_hours': '‚ö†Ô∏è –û–ø–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ —á–∞—Å—ã',
        'late_days': '‚ùå –û–ø–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –¥–Ω–∏'
    }
    return descriptions.get(timing, '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
